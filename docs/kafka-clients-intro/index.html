
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Kafka-clients introduction</title>
  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../elements/codelab.html">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <style is="custom-style">
    body {
      font-family: "Roboto",sans-serif;
      background: var(--google-codelab-background, #F8F9FA);
    }
  </style>
  
</head>
<body unresolved class="fullbleed">

  <google-codelab title="Kafka-clients introduction"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Overview of the tutorial" duration="10">
        <p>This tutorial shows you how to create a Kafka-consumer and -producer using <a href="http://kafka.apache.org/documentation/#api" target="_blank">kafka-clients</a> java library.</p>
<p>What you&#39;ll learn</p>
<ul>
<li>How to create a Kafka producer that produce data from a Kafka-broker</li>
<li>How to create a Kafka consumer that reads data from a Kafka-broker</li>
</ul>
<aside class="special"><p>This tutorial requires that you are familiar with Java programming language.</p>
</aside>
<h2>Prerequisites</h2>
<ul>
<li>Internet connectivity</li>
<li>Java SKD installed - see <a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank">https://www.oracle.com/technetwork/java/javase/downloads/index.html</a> for instructions.</li>
<li>Docker - see <a href="https://www.docker.com/get-started" target="_blank">https://www.docker.com/get-started</a> for instructions.</li>
<li>InelliJ IDEA installed. Choose the Community version from the download link <a href="https://www.jetbrains.com/idea/download" target="_blank">IntelliJ Idea</a></li>
<li>Optional: Git installed - see <a href="https://git-scm.com/" target="_blank">https://git-scm.com/</a> for instructions.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Set up" duration="5">
        <h2>Java and project setup</h2>
<p><a href="https://github.com/navikt/codelab-kafka-clients/archive/master.zip" target="_blank">Download project</a></p>
<p>Extract the project to a directory. An alternative, use git to clone the project.<br>(On NAV developer image you will need add proxy by running <code>git config --global http.proxy http://webproxy-utvikler.nav.no:8088</code> first)</p>
<pre><code>git clone https://github.com/navikt/codelab-kafka-clients.git
</code></pre>
<p>In project root, run gradle:</p>
<pre><code>$ cd codelab-kafka-clients
$ ./gradlew --offline build
</code></pre>
<p>or in Windows:</p>
<pre><code>$ cd codelab-kafka-clients
$ gradlew.bat --offline build
</code></pre>
<p>If everything is set up you should see</p>
<pre><code>BUILD SUCCESSFUL in Xs
</code></pre>
<aside class="warning"><p>On NAV developer image: If you get an <code>Connection refused</code> error when executing gradle.</p>
</aside>
<p>Add a file named <code>gradle.properties</code> in an folder named <code>.gradle</code> in your home directory with the following content:</p>
<pre><code>systemProp.proxySet=true
systemProp.http.proxyHost=webproxy-utvikler.nav.no
systemProp.http.proxyPort=8088
systemProp.https.proxyHost=webproxy-utvikler.nav.no
systemProp.https.proxyPort=8088
</code></pre>
<p>Windows: <code>C:\Users\&lt;username&gt;\.gradle\gradle.properties</code><br>Linux and Mac: <code>~/.gradle/gradle.properties</code></p>
<h2>Docker</h2>
<p>In the project directory, there is a <code>docker-compose.yml</code> file, navigate to the file and run docker-compose:</p>
<pre><code>$ docker-compose up
</code></pre>
<p>This should start Zookeeper and a Kafka instance locally.</p>
<h2>IntelliJ</h2>
<ul>
<li>Open the project in IntelliJ by choosing: <code>File -&gt; New -&gt; Project from Existing sources...</code> navigate to project folder and press OK</li>
<li>Choose <code>Gradle</code> in next window - Next</li>
<li>Underneath <code>Global Gradle settings</code> - choose <code>Offline work</code> and hit <code>Finish</code></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Fizz-buzz game with Kafka" duration="3">
        <ol type="1">
<li>Create a consumer that consume the <code>FizzBuzzNumberEntered</code> topic (See FizzBuzzCandidateProducer.java in the project).</li>
<li>Based on the number in <code>FizzBuzzNumberEntered</code>, calculate whether or not that number is a <a href="https://en.wikipedia.org/wiki/Fizz_buzz" target="_blank">&#34;Fizz-Buzz&#34; number</a> candidate and</li>
<li>produce a message to Kafka with topic <code>FizzBuzzAnswered</code> with the answer.</li>
</ol>
<p>The answer must be compliant to JSON file:</p>
<pre><code>{
  &#34;answer&#34;: &#34;FizzBuzz&#34;, // - &#34;FizzBuzz&#34;, &#34;Fizz&#34; or &#34;Buzz&#34;
  &#34;candidate&#34; : 15, // Number entered
  &#34;groupId&#34; : &#34;A-team&#34; // Identicator of the team
}
</code></pre>
<p>â€¢ Fizz-Buzz test - Write a program that prints the numbers from 1 to 100. But for multiples of three print &#34;Fizz&#34; instead of the number and for the multiples of five print &#34;Buzz&#34;. For numbers which are multiples of both three and five print &#34;FizzBuzz&#34;<br>Ref <a href="https://en.wikipedia.org/wiki/Fizz_buzz" target="_blank">https://en.wikipedia.org/wiki/Fizz_buzz</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="The FizzBuzzNumberEntered topic producer" duration="10">
        <p>Provided in the project there is a Java class named <code>FizzBuzzCandidateProducer</code>. This class produce random numbers on a topic named <code>FizzBuzzNumberEntered</code>.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Create an FizzBuzzNumberEntered topic consumer" duration="10">
        <ul>
<li>In IntelliJ - Create a new Java file, give it a name (e.g. <code>FizzBuzzNumberEnteredConsumer.java</code>)</li>
<li>We need to declare a <code>KafkaConsumer</code> and instantiate it;</li>
</ul>
<pre><code>public class FizzBuzzNumberEnteredConsumer {

    private final static String TOPIC = &#34;FizzBuzzNumberEntered&#34;;
    private final static String BOOTSTRAP_SERVERS = &#34;localhost:9092&#34;;

    public static void main(String[] args) {
        Properties consumerProperties = new Properties();
        consumerProperties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS);
        consumerProperties.put(ConsumerConfig.GROUP_ID_CONFIG, &#34;fizzbuzz-consumer&#34;);
        consumerProperties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        consumerProperties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, IntegerDeserializer.class);


        KafkaConsumer&lt;String, Integer&gt; consumer = new KafkaConsumer&lt;&gt;(consumerProperties);
        consumer.subscribe(Collections.singleton(TOPIC));

    }
}

</code></pre>
<ul>
<li>The above code is enough to configure a Kafka-consumer against a broker.  But in order to consume messages we need a few more lines of code:</li>
</ul>
<pre><code>      while (true) {
          ConsumerRecords&lt;String, Integer&gt; records = consumer.poll(Duration.ofMillis(100)); // Fetch records, give up after timeout
          for (ConsumerRecord&lt;String, Integer&gt; record : records) {
              System.out.println(&#34;Consumed &#34; + record);
          }
      }
</code></pre>
<ul>
<li>We should now be able to consume records from Kafka. Try it out by first start the consumer we just created (Run the main method in IntelliJ) and then start the producer, <code>FizzBuzzCandidateProducer</code> (Run the main method in IntelliJ). If all looks good, go ahead to the next section.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Calculate FizzBuzz and produce the answer to kafka" duration="30">
        <p>Provided in the project there is an FizzBuzz &#34;calculator&#34; we can use to calculate the answer.</p>
<pre><code>      while (true) {
          ConsumerRecords&lt;String, Integer&gt; records = consumer.poll(Duration.ofMillis(100)); // Fetch records, give up after timeout
          for (ConsumerRecord&lt;String, Integer&gt; record : records) {
              System.out.println(&#34;Consumed &#34; + record);
              // first extract the number from the record
              Integer number = record.value();
              // Calculate FizzBuzz
              String fizzBuzzCandidate = FizzBuzz.calculate(number);
              FizzBuzzAnswerMessage answer = new FizzBuzzAnswerMessage(fizzBuzzCandidate, number, &#34;A-Team&#34;);
              
              // create json 
              final String answerAsJson = new Gson().newBuilder().create().toJson(answer);
              
              // @todo: Produce answer to `FizzBuzzAnswered` topic
              
              // tip: See FizzBuzzCandidateProducer.java 
              
          }
      }
</code></pre>


      </google-codelab-step>
    
  </google-codelab>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49880327-14', 'auto');

    (function() {
      var gaCodelab = '0';
      if (gaCodelab) {
        ga('create', gaCodelab, 'auto', {name: 'codelab'});
      }

      var gaView;
      var parts = location.search.substring(1).split('&');
      for (var i = 0; i < parts.length; i++) {
        var param = parts[i].split('=');
        if (param[0] === 'viewga') {
          gaView = param[1];
          break;
        }
      }
      if (gaView && gaView !== gaCodelab) {
        ga('create', gaView, 'auto', {name: 'view'});
      }
    })();
  </script>

</body>
</html>
